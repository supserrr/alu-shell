#!/usr/bin/env bash
# Lists running processes with process hierarchy

# Use ps aux to get all processes, including those without a TTY
ps aux | awk '{print $1, $2, $3, $4, $5, $6, $7, $8, $10}' | sed 's/^[ \t]*//g' | sed 's/[ \t]*$//g' | while read user pid cpu mem vsz rss tty stat start time command; do
  # Check if the process is a child of the current process
  parent=$(pgrep -P "$pid")
  if [[ "$parent" != "" ]]; then
    # Indent the child process
    command="  $command"
  fi
  # Print the process information
  printf "%-15s %-6s %-5s %-5s %-6s %-6s %-8s %-8s %-15s %s\n" "$user" "$pid" "$cpu" "$mem" "$vsz" "$rss" "$tty" "$stat" "$start" "$command"
done
